import{j as s,r as a,F as H,t as P,z as N,B as q,A as G,e as J}from"./index-DXJGac9T.js";import{C as X,a as K}from"./index-BFkFjZue.js";const Q=({strokeColor:o="white",...i})=>s.jsx("svg",{...i,width:i.width||"40",height:i.height||"40",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M6.66675 9.99935H13.3334M10.0001 6.66602L10.0001 13.3327",stroke:o,strokeWidth:"1.25",strokeLinecap:"round"})}),V=({strokeColor:o="white",...i})=>s.jsx("svg",{...i,width:i.width||"40",height:i.height||"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M8 12H16",stroke:o,"stroke-width":"1.5","stroke-linecap":"round"})}),Z=o=>o==="Одноцепная башенного типа"?"#7984F1":o==="Двухцепная башенного типа"?"#61C6FF":o==="Свободно стоящая типа «рюмка»"?"#F179C1":o==="Портальная на оттяжках"?"#79F17E":o==="Другие классы"?"#FFDC61":"#000000",tt=({imageUrl:o,annotations:i})=>{const[r,y]=a.useState(1),[u,f]=a.useState({x:0,y:0}),[k,j]=a.useState(!1),[w,x]=a.useState(null),h=a.useRef(null),[Y,v]=a.useState(null),[S,b]=a.useState(null);a.useEffect(()=>{const t=h.current,e=t==null?void 0:t.getContext("2d");if(t&&e){const n=new Image;n.src=o,n.onload=()=>{t.width=n.width,t.height=n.height,(()=>{e.clearRect(0,0,t.width,t.height),e.save(),e.scale(r,r),e.translate(u.x,u.y),e.drawImage(n,0,0),i.forEach(({x_center:g,y_center:d,width:l,height:c,object_class:M})=>{const p=(g-l/2)*n.width,F=(d-c/2)*n.height,C=l*n.width,D=c*n.height;e.strokeStyle=Z(M),e.lineWidth=20/r,e.strokeRect(p,F,C,D)}),e.restore()})()}}},[o,i,r,u]);const z=t=>{j(!0),x({x:t.clientX,y:t.clientY})},L=()=>{j(!1),x(null)},W=t=>{const e=h.current;if(!e)return;const n=e.getBoundingClientRect(),m=e.width/n.width,g=e.height/n.height;if(k&&w){const d=(t.clientX-w.x)/r,l=(t.clientY-w.y)/r;f(c=>({x:c.x+d,y:c.y+l})),x({x:t.clientX,y:t.clientY})}else{const d=(t.clientX-n.left)*m,l=(t.clientY-n.top)*g,c=d/r-u.x,M=l/r-u.y;let p=null;i.forEach(F=>{const{x_center:C,y_center:D,width:B,height:E}=F,I=(C-B/2)*e.width,R=(D-E/2)*e.height,T=B*e.width,U=E*e.height;c>=I&&c<=I+T&&M>=R&&M<=R+U&&(p=F,b({x:t.clientX,y:t.clientY}))}),v(p),p||b(null)}},_=()=>{v(null),b(null)},$=()=>{y(t=>{const e=Math.min(t+.1,3);return A(e,t),e})},O=()=>{y(t=>{const e=Math.max(t-.1,.5);return A(e,t),e})},A=(t,e)=>{f(n=>{const m=h.current;if(!m)return n;const g=m.getBoundingClientRect(),d=g.width/2,l=g.height/2,c=t/e;return{x:(n.x-d)*c+d,y:(n.y-l)*c+l}})};return s.jsxs(H,{position:"relative",maxH:"90svh",w:"100%",justifyContent:"center",children:[s.jsxs(H,{position:"absolute",top:"45%",left:"10px",flexDirection:"column",gap:"10px",zIndex:"10",children:[s.jsx(P,{icon:s.jsx(Q,{}),background:"#83D2FF",onClick:$,"aria-label":"plus"}),s.jsx(P,{icon:s.jsx(V,{}),background:"#83D2FF",onClick:O,"aria-label":"minus"})]}),s.jsx("canvas",{ref:h,style:{maxWidth:"100%",height:"100%"},onMouseDown:z,onMouseMove:W,onMouseUp:L,onMouseLeave:_}),Y&&S&&s.jsx(N,{label:Y.object_class,isOpen:!0,placement:"top",bg:"blackAlpha.700",color:"white",borderRadius:"md",fontSize:"md",px:"4",py:"2",hasArrow:!0,children:s.jsx(q,{position:"fixed",left:`${S.x}px`,top:`${S.y-10}px`,transform:"translate(-50%, -100%)",zIndex:"999"})})]})},st=()=>{const{id:o}=G(),[i,r]=a.useState({}),[y,u]=a.useState(!0),[f,k]=a.useState(null);if(a.useEffect(()=>{(async()=>{try{u(!0);const h=await K(Number(o));r(h.data)}catch(h){console.log(h),k("Не удалось загрузить данные")}finally{u(!1)}})()},[o]),y)return s.jsx(X,{children:"Загрузка..."});if(f)return s.jsx(X,{children:f});const{labeling:j,original_s3_url:w}=i;return s.jsx(X,{children:s.jsx(J,{maxH:"90svh",children:s.jsx(tt,{imageUrl:w,annotations:j.map(x=>({...x}))})})})};export{st as default};
